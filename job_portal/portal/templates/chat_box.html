{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Box</title>
    <link rel="stylesheet" href="{% static 'portal/college_after_login.css' %}">
    <style>
        .chat-container { max-width: 600px; margin: 40px auto; background: #fff; border-radius: 10px; box-shadow: 0 2px 12px #0002; padding: 24px; }
        .chat-messages { min-height: 200px; max-height: 350px; overflow-y: auto; margin-bottom: 18px; background: #f7faff; border-radius: 6px; padding: 12px; }
        .chat-message { margin-bottom: 12px; }
        .chat-message.me { text-align: right; }
        .chat-message .sender { font-weight: bold; color: #1976d2; }
        .chat-message .text { display: inline-block; background: #e3f0fd; border-radius: 6px; padding: 8px 14px; margin-top: 2px; }
        .chat-form { display: flex; gap: 8px; }
        .chat-form input[type=text] { flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #b6c6e3; }
        .chat-form button { background: #1976d2; color: #fff; border: none; border-radius: 4px; padding: 8px 18px; font-weight: 600; }
    </style>
</head>
<body>
    <div class="chat-container">
        <h2>Chat for Ticket: {{ ticket.college.college_name }} &mdash; {{ ticket.company.company_name }}</h2>
        <div class="chat-messages" id="chatMessages">
            {% for m in messages %}
                {% if m.sender == 'College' %}
                    <div class="chat-message" style="text-align: left;">
                        <span class="sender">{{ ticket.college.college_name }}</span>
                        <span class="text">{{ m.text }}</span>
                    </div>
                {% elif m.sender == 'Company' %}
                    <div class="chat-message me" style="text-align: right;">
                        <span class="sender">{{ ticket.company.company_name }}</span>
                        <span class="text">{{ m.text }}</span>
                    </div>
                {% else %}
                    <div class="chat-message">
                        <span class="sender">Unknown</span>
                        <span class="text">{{ m.text }}</span>
                    </div>
                {% endif %}
            {% empty %}
                <div class="chat-message"><span class="sender">System</span>: <span class="text">Chat started for this ticket.</span></div>
            {% endfor %}
        </div>
        <form class="chat-form" method="post" action="">
            {% csrf_token %}
            <input type="text" name="message" placeholder="Type your message..." required>
            <input type="hidden" name="sender" value="{{ sender_type }}">
            <button type="submit">Send</button>
        </form>
        <a href="{% if ticket.college.id and request.GET.college_id %}{% url 'college_after_login' ticket.college.id %}{% elif ticket.company.id and request.GET.company_id %}{% url 'company_after_login' ticket.company.id %}{% else %}javascript:history.back(){% endif %}" style="display:block;margin-top:18px;">&larr; Back</a>
    </div>
</body>
</html>
